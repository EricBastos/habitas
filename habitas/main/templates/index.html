{% extends '_base.html' %}
{% load static %}


{% block header %}

<link rel="stylesheet" href="{% static 'index.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
    integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
    integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>

{% endblock %}

{% block title %} Habitas {% endblock %}

{% block content %}


<div class="z-0 flex w-full place-content-center">
    <div id="map" class="z-0 w-4/5 self-center" style="height: 500px"></div>
</div>

<div>
    <p id="text"></p>
</div>


<script>

    // load trees from context to list

    var map = L.map('map').setView([-23.205459913570404, -45.88184219354045], 15);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);



    function onMapClick(index) {

        tree_dict = tree_array[index]
        document.getElementById("text").innerHTML = "Nome popular: " + tree_dict.nome_popular + "<br>" + "Nome científico: " + tree_dict.nome_cientifico + "<br>" + "DAP: " + tree_dict.dap + "<br>" + "Altura: " + tree_dict.altura + "<br>" + "Data da coleta: " + tree_dict.data_da_coleta + "<br>" + "Latitude: " + tree_dict.latitude + "<br>" + "Longitude: " + tree_dict.longitude;


    }


</script>

<script>
    tree_array = []
    circlearray = [];

    {% for tree in trees %}

    tree_obj = {
        nome_popular: "{{ tree.nome_popular }}",
        nome_cientifico: "{{ tree.nome_cientifico }}",
        dap: "{{ tree.dap }}",
        altura: "{{ tree.altura }}",
        data_da_coleta: "{{ tree.data_da_coleta }}",
        latitude: "{{ tree.latitude }}",
        longitude: "{{ tree.longitude }}"
    };

    tree_array.push(tree_obj);

    circle = L.circle([{{ tree.latitude }}, {{ tree.longitude }}], {
        color: 'green',
        fillColor: '#040',
        fillOpacity: 0.5,
        radius: 5
    }).addTo(map);
    circlearray.push(circle);

    {% endfor %}

    circlearray.forEach(function (circle, index) {
        tree_dict = tree_array[index]
        popup = `<span class="font-bold text-ellipsis">Nome popular:</span> ${tree_dict.nome_popular}<br>` +
            `<span class="font-bold text-ellipsis">Nome científico:</span> ${tree_dict.nome_cientifico}<br>` +
            `<span class="font-bold text-ellipsis">Diâmetro:</span> ${tree_dict.dap}cm<br>`
        "DAP: " + tree_dict.dap + "<br>" + "Altura: " + tree_dict.altura + "<br>" + "Data da coleta: " + tree_dict.data_da_coleta + "<br>" + "Latitude: " + tree_dict.latitude + "<br>" + "Longitude: " + tree_dict.longitude;
        circle.bindPopup(popup)
    });



</script>

{% endblock %}